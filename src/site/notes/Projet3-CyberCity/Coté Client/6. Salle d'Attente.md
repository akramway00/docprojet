---
{"dg-publish":true,"permalink":"/projet3-cyber-city/cote-client/6-salle-d-attente/"}
---

# Salle d'Attente

La Salle d'Attente (`WaitingRoomPageComponent`) est l'interface où les joueurs se rassemblent avant le début d'une partie. Elle permet aux joueurs de voir qui rejoint la partie, de discuter via le chat, et à l'administrateur de gérer la partie (verrouiller/déverrouiller, ajouter des joueurs virtuels, démarrer la partie, etc.).

# WaitingRoomPageComponent

### Propriétés

|Propriété|Type|Description|
|---|---|---|
|`@ViewChild('neonCursorApp')`|`ElementRef`|Référence à l'élément DOM du mini-jeu d'effet néon|
|`onGoingGame`|`OnGoingGame`|Instance du jeu en attente|
|`gameCode`|`string`|Code d'accès à la partie|
|`isLocked`|`boolean`|Indique si la partie est verrouillée|
|`isGameFull`|`boolean`|Indique si la partie a atteint sa capacité maximale|
|`mode`|`string`|Mode d'entrée ('create' pour créateur, 'join' pour participant)|
|`isAdmin`|`boolean`|Indique si l'utilisateur est l'administrateur de la partie|
|`players`|`Player[]`|Liste des joueurs dans la salle d'attente|
|`defaultPlayers`|`(Player \| null)[]`|Tableau des emplacements de joueurs (avec des valeurs null pour les emplacements vides)|
|`showMiniGame`|`boolean`|Contrôle l'affichage du mini-jeu Néon|
|`neonCursorInstance`|`unknown`|Instance du script du mini-jeu|
|`isPopupActive`|`boolean`|Contrôle l'affichage du popup d'erreur général|
|`isValidationPopupActive`|`boolean`|Contrôle l'affichage du popup de validation|
|`isGameCancelledPopup`|`boolean`|Contrôle l'affichage du popup d'annulation de partie|
|`isPlayerKickedPopupActive`|`boolean`|Contrôle l'affichage du popup d'exclusion|
|`isKickValidationPopupActive`|`boolean`|Contrôle l'affichage du popup de confirmation d'exclusion|
|`isVirtualPlayerChoiceActive`|`boolean`|Contrôle l'affichage du popup de choix de joueur virtuel|
|`playerNameToKick`|`string`|Nom du joueur à exclure|
|`popupMessage`|`string`|Message à afficher dans les popups|
|`gridLimits`|`{ [key: number]: number }`|Limite de joueurs en fonction de la taille de la grille|
|`private subscriptions`|`Subscription[]`|Liste des abonnements aux observables|

### Méthodes

`constructor(private router: Router, private route: ActivatedRoute, private characterCreation: CharacterCreationService, private waitingRoomService: WaitingRoomService, private renderer: Renderer2)`

**Description** : Initialise le composant avec les services nécessaires et configure les abonnements aux événements socket. 
**Paramètres** :

- `router`: Service de navigation Angular
- `route`: Service pour accéder aux paramètres de route
- `characterCreation`: Service de création de personnage
- `waitingRoomService`: Service de gestion de la salle d'attente
- `renderer`: Service pour manipuler le DOM

**Détails** : Configure plusieurs abonnements pour gérer les mises à jour de l'état du jeu, le verrouillage, le démarrage, l'annulation et l'exclusion des joueurs.

`ngOnInit()`

**Description** : Initialise le composant au chargement et détermine si l'utilisateur est l'administrateur. 
**Retour** : void 
**Détails** : Utilise les paramètres de route pour déterminer le mode ('create' ou 'join') et définit `isAdmin` en conséquence.

`toggleLock()`

**Description** : Bascule l'état de verrouillage de la partie si possible. 
**Retour** : void 
**Détails** : Vérifie d'abord si la partie est pleine avant de permettre le déverrouillage. Communique avec le service `waitingRoomService` pour mettre à jour l'état sur le serveur.

`startGame()`

**Description** : Vérifie les conditions pour démarrer la partie et l'initialise si tout est en ordre. 
**Retour** : void 
**Détails** : Vérifie que la partie est verrouillée, qu'il y a au moins 2 joueurs, et que le mode CTF a un nombre pair de joueurs si nécessaire. Utilise le service `waitingRoomService` pour démarrer la partie.

`kickPlayerValidation(playerName: string)`

**Description** : Prépare l'exclusion d'un joueur en affichant un popup de confirmation. 
**Paramètres** : `playerName`: Nom du joueur à exclure 
**Retour** : void
**Détails** : Stocke le nom du joueur et affiche le popup de confirmation.

`kickPlayer()`

**Description** : Confirme l'exclusion d'un joueur de la partie. 
**Retour** : void 
**Détails** : Vérifie que la partie et le code existent, puis utilise le service `waitingRoomService` pour exclure le joueur.

`quitRoomValidation()`

**Description** : Affiche un popup de confirmation pour quitter la salle d'attente ou annuler la partie. 
**Retour** : void 
**Détails** : Adapte le message selon que l'utilisateur est l'administrateur ou un joueur normal.

`quitRoom()`

**Description** : Quitte la salle d'attente ou annule la partie. 
**Retour** : void 
**Détails** : Utilise le service `waitingRoomService` pour notifier le serveur, déverrouille la partie si en mode 'join', et redirige vers la page d'accueil.

`addTypeChoice()`

**Description** : Prépare l'ajout d'un joueur virtuel en affichant le popup de choix du type. 
**Retour** : void 
**Détails** : Vérifie d'abord que la partie n'est pas verrouillée avant de permettre l'ajout.

`addVirtualPlayer(playerType: string)`

**Description** : Ajoute un joueur virtuel du type spécifié à la partie. 
**Paramètres** : `playerType`: Type de joueur virtuel ('AggressiveBot' ou 'DefensiveBot') 
**Retour** : void 
**Détails** : Vérifie d'abord que la partie n'est pas pleine avant d'ajouter le joueur virtuel.

`closeVirtualPlayerChoice()`

**Description** : Ferme le popup de choix de joueur virtuel.
**Retour** : void

`closeValidationPopup()`

**Description** : Ferme les popups de validation et de confirmation d'exclusion. 
**Retour** : void

`closePopup()`

**Description** : Ferme le popup d'erreur général. 
**Retour** : void

`closeGameCancelledPopup()`

**Description** : Ferme le popup d'annulation de partie et redirige vers la page d'accueil.
**Retour** : void

`closePlayerKickedPopup()`

**Description** : Ferme le popup d'exclusion et redirige vers la page d'accueil.
**Retour** : void

`playMiniGames()`

**Description** : Active l'affichage du mini-jeu d'effet néon.
**Retour** : void 
**Détails** : Utilise un délai pour charger le script après l'affichage de l'interface.

`closeMiniGame()`

**Description** : Ferme le mini-jeu et nettoie les ressources associées. 
**Retour** : void 
**Détails** : Supprime les éléments canvas ajoutés et réinitialise l'instance.

`quitGame()`

**Description** : Redirige directement vers la page d'accueil. 
**Retour** : void

`ngOnDestroy()`

**Description** : Nettoie les abonnements lors de la destruction du composant. 
**Retour** : void 
**Détails** : Annule tous les abonnements pour éviter les fuites de mémoire.

`loadNeonCursorScript()`

**Description** : Charge dynamiquement le script pour le mini-jeu d'effet néon.
**Retour** : void 
**Détails** : Crée un élément script et l'ajoute au DOM pour charger et initialiser l'effet néon.

`updateUI(game: OnGoingGame)`

**Description** : Met à jour l'interface utilisateur avec les informations de la partie.
**Paramètres** : `game`: Instance mise à jour du jeu 
**Retour** : void 
**Détails** : Met à jour les propriétés du composant et réorganise le tableau des emplacements de joueurs.

### Éléments HTML importants

- **Grille des joueurs** : Affiche les joueurs actuellement dans la salle d'attente
- **Zone d'informations** : Affiche le code d'accès pour que d'autres joueurs puissent rejoindre
- **Boutons d'administration** : Verrouiller/déverrouiller, lancer la partie, ajouter un joueur virtuel, annuler la partie (pour l'administrateur)
- **Boutons de joueur** : Mini-jeux d'attente, quitter la partie (pour les joueurs non-administrateurs)
- **Mini-jeu néon** : Interface interactive pour patienter
- **Divers popups** : Confirmation, validation, erreurs, choix de joueur virtuel
- **Composant de chat** : Permet aux joueurs de communiquer


---
{"dg-publish":true,"permalink":"/projet3-cyber-city/cote-client/5-creation-de-personnage/"}
---

# Création de Personnage

La page de Création de Personnage (`CharacterCreationPageComponent`) permet aux utilisateurs de créer un personnage avec des attributs personnalisés avant de rejoindre ou de créer une partie. Cette page sert de transition entre la sélection d'un jeu et l'entrée dans la salle d'attente.

# CharacterCreationPageComponent

### Propriétés

|Propriété|Type|Description|
|---|---|---|
|`characterForm`|`FormGroup`|Formulaire pour les données du personnage|
|`avatars`|`string[]`|Liste des avatars disponibles|
|`selectedAvatarIndex`|`number`|Index de l'avatar sélectionné|
|`startIndex`|`number`|Index de départ pour l'affichage des avatars|
|`visibleAvatars`|`string[]`|Sous-ensemble des avatars visibles|
|`attributes`|`Object`|Statistiques du personnage (vie, vitesse, attaque, défense)|
|`isPopupActive`|`boolean`|Contrôle l'affichage du popup d'erreur|
|`isGameCancelledPopup`|`boolean`|Contrôle l'affichage du popup d'annulation de partie|
|`popupMessage`|`string`|Message à afficher dans les popups|
|`dice`|`Object`|Configuration des dés (attaque, défense)|
|`selectedGame`|`Game`|Jeu sélectionné pour la partie|
|`mode`|`string`|Mode d'accès à la page ('create' ou 'join')|
|`gameCode`|`string`|Code de la partie (en mode 'join')|
|`isGameLocked`|`boolean`|Indique si la partie est verrouillée|
|`onGoingGame`|`OnGoingGame`|Objet représentant la partie en cours|
|`takenAvatars`|`string[]`|Liste des avatars déjà pris par d'autres joueurs|
|`subscriptions`|`Subscription[]`|Liste des souscriptions à nettoyer|
### Méthodes

 `constructor(formBuilder, router, route, gameService, gameCreationService, characterCreationService, waitingRoomService)`

**Description** : Initialise le composant avec les services nécessaires et configure le formulaire.  
**Paramètres** :

- `formBuilder`: Service de création de formulaires
- `router`: Service de navigation
- `route`: Service d'accès aux paramètres de route
- `gameService`: Service de gestion des jeux
- `gameCreationService`: Service de création de partie
- `characterCreationService`: Service de création de personnage
- `waitingRoomService`: Service de gestion de la salle d'attente

**Détails** : Configure les abonnements aux événements de verrouillage de partie, mise à jour de partie et annulation de partie.

 `ngOnInit()`

**Description** : Initialise le composant au démarrage et traite les paramètres de route.  
**Retour** : void  
**Détails** : Détermine le mode (création ou participation) et le code de la partie, puis appelle handleJoinMode() si nécessaire.

 `handleJoinMode()`

**Description** : Configure le composant pour rejoindre une partie existante.  
**Retour** : void  
**Détails** : Demande les informations de la partie et s'abonne aux mises à jour pour connaître les joueurs existants et leurs avatars.

 `fetchTakenAvatars()`

**Description** : Récupère la liste des avatars déjà pris par d'autres joueurs.  
**Retour** : void  
**Détails** : Extrait les avatars des joueurs déjà présents dans la partie.

 `selectAvatar(index: number)`

**Description** : Sélectionne un avatar dans la liste.  
**Paramètres** : index: Index de l'avatar à sélectionner  
**Retour** : void  
**Détails** : Met à jour le formulaire avec l'avatar choisi.

 `nextAvatar()`

**Description** : Affiche le groupe suivant d'avatars.  
**Retour** : void  
**Détails** : Incrémente l'indice de départ ou revient au début si nécessaire, puis met à jour les avatars visibles.

 `previousAvatar()`

**Description** : Affiche le groupe précédent d'avatars.  
**Retour** : void  
**Détails** : Décrémente l'indice de départ ou va à la fin si nécessaire, puis met à jour les avatars visibles.

 `assignBonus(attribute: 'health' | 'speed')`

**Description** : Attribue les points bonus à un attribut spécifique.  
**Paramètres** : attribute: Attribut qui recevra le bonus ('health' ou 'speed')  
**Retour** : void  
**Détails** : Bascule entre activer et désactiver le bonus sur l'attribut spécifié.

 `assignDiceOption(choice: 'D4' | 'D6')`

**Description** : Configure les dés pour l'attaque et la défense.  
**Paramètres** : choice: Type de dé choisi pour l'attaque ('D4' ou 'D6')  
**Retour** : void  
**Détails** : Définit le type de dé pour l'attaque et utilise l'autre type pour la défense.

`verifyName(): boolean`

**Description** : Vérifie si le nom entré est valide et unique.  
**Retour** : boolean - Vrai si le nom est valide  
**Détails** : Vérifie que le nom n'est pas vide et n'est pas déjà pris par un autre joueur. Génère un nom unique si nécessaire.

 `verifyAvatar(): boolean`

**Description** : Vérifie si un avatar a été sélectionné et est disponible.  
**Retour** : boolean - Vrai si l'avatar est valide  
**Détails** : Vérifie qu'un avatar est sélectionné et qu'il n'est pas déjà pris par un autre joueur.

 `verifyBonus(): boolean`

**Description** : Vérifie si des points bonus ont été attribués.  
**Retour** : boolean - Vrai si les bonus sont attribués  
**Détails** : Vérifie qu'au moins un attribut a reçu des points bonus.

`verifyDice(): boolean`

**Description** : Vérifie si les dés ont été configurés.  
**Retour** : boolean - Vrai si les dés sont configurés  
**Détails** : Vérifie que les dés ne sont pas à leurs valeurs par défaut.

 `async verifyVisibility(): Promise<boolean>`

**Description** : Vérifie si le jeu sélectionné est toujours visible.  
**Retour** : Promise - Vrai si le jeu est visible  
**Détails** : Utilise le service GameService pour vérifier la visibilité du jeu sur le serveur.

 `async verifyForm(): Promise<void>`

**Description** : Vérifie l'ensemble du formulaire avant de créer le personnage.  
**Retour** : Promise
**Détails** : Vérifie nom, avatar, bonus, dés et visibilité du jeu. Si tout est valide, appelle sendForm().

`sendForm(): void`

**Description** : Crée le personnage et démarre ou rejoint la partie.  
**Retour** : void  
**Détails** : Crée un objet Player, puis soit crée une nouvelle partie, soit rejoint une partie existante. Redirige vers la salle d'attente avec le mode approprié.

`createPlayer(): Player`

**Description** : Crée un objet Player à partir des informations du formulaire.  
**Retour** : Player - Nouvel objet joueur  
**Détails** : Extrait les données du formulaire et crée un objet Player avec les attributs appropriés.

`closePopup(): void`

**Description** : Ferme le popup d'erreur.  
**Retour** : void

 `closeGameCancelledPopup(): void`

**Description** : Ferme le popup de partie annulée et redirige vers l'accueil.  
**Retour** : void  
**Détails** : Ferme le popup et navigue vers la page d'accueil.

`goToPreviousPage()`

**Description** : Navigue vers la page précédente.  
**Retour** : void  
**Détails** : Détermine la page précédente en fonction du mode (création ou participation).

`ngOnDestroy(): void`

**Description** : Nettoie les abonnements lors de la destruction du composant.  
**Retour** : void  
**Détails** : Désinscrit tous les abonnements pour éviter les fuites mémoire.

`updateVisibleAvatars(): void`

**Description** : Met à jour la liste des avatars visibles.  
**Retour** : void  
**Détails** : Extrait un sous-ensemble des avatars en fonction de l'indice de départ.